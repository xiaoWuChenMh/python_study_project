
### 说明

* 流程说明
```text 
对应师门任务来说，可以通过事件和行为来拆分：
  事件：师门中的一次完成的任务流程，比如寻物、道具，还需要知道每个事件中还可细分小类寻物包含npc商店购买、玩家商店购买
  行为：事件中的每一个点击都是一个行为，用激活下一步行为。
 
理想的方案是希望尽量将事件拆分成行为，让行为处于同一级并列检查执行，这样可以避免某些操作（人为误操作、游戏中的飘花、喇叭、飘红包）打断任务执行流程。
但某些事件中的行为触发具有前后因果关系、同时一个行为被触发后也需要激活时间，导致该目标很难达成。
不仅如此，还有一些特殊情况，某些元素激活了“npc多选框”，但下一步是“任务列表首列行为”，会导致“npc多选框”取消，然后当执行到“npc多选框”行为时检查不到，陷入“在某个行为激活，在点击取消，在检查失败”的无限循环过程。

前后因果关系，可以引入状态，用状态控制下一步执行的行为。同时在加入超时设定，如果超时将状态恢复从头开始执行事件
需要反应or激活时间：这些时间和卡不卡也有关系，有的3秒执行，有的5秒执行，因此将改时间改为用户可配置的
有些行为关系紧密且对时机敏感，可以放到一个行为中，如玩家、npc商店购物，但也要在最后做页面关闭处理防止某些行为没有生效进而导致判断卡住无法进行下去。

因此：先拆分成行为、在引入状态和超时、接着加入反应时间、最后为优化效率和处理时机敏感事件，将行为串起来组合成一个行为如npc商店购物。

```
* 事件种类和行为种类说明

```text
师门任务来说包含如下的一些事件：
   道具：打怪、莲花
   寻物：药品、装备、法宝（89以上？）
   副本打怪；70级以上才会有，
   动作：还没遇到
   师门等级升级通知
   师门任务完成通知
   
师门任务来说包含如下的一些行为：
  任务列表首列：默认第一栏是当前任务，点击会激活后续动作，中间领取到其他任务该原则会失效；
  npc多选框_点击top1：可以通过选择触发不同任务的npc多选框，默认领取任务都是top1，有例外，比如跑商；
  npc对话框（底部）：底层显示黑色背景的文字描述，用来程序当前npc说的话，循环点击来触发下一步；
  使用道具: 游戏页面右侧弹出小窗口，点击后激活道具的使用，大概需要5秒
  npc商店购买：
    npc商店购买按钮:购买商品，各类装备、低端药品【钱不够会购买失败，导致任务流程卡住】
    npc商店关闭按钮:购买完成后，需要关闭
  玩家商店购买：
    玩家商店购买按钮:购买商品，各类状态药、法宝 【钱不够会购买失败，导致任务流程卡住】
    玩家商店确认购买按钮：有时某些物品的购买，需要再次确认是否购买，
    玩家商店关闭按钮:购买完成后，需要关闭
    玩家法宝搜索按钮：购买法宝前，需要先点击搜索，才能进入到购买页面。
  提交装备：提交装备使会将包裹里存在的珍品装备被提交上去，因此在提交前需要先购买，且此动作包含多个不可拆分的小世界：
      购买其他按钮：
      npc商店购买按钮：
      npc商店购买中：包括跑图+npc商店购买物品
      npc商店完_激活提交动作：
      装备上交按钮：
      再次确认是否上交装备：只要是npc商店购买的，就不会激发该行为
  是否在副本内：如果确认在副本内，需要释放技能
  退出副本通知：
  打开活动按钮：
  活动页面_查找活动参加按钮：
  活动页面_关闭：
  
  
```

### 事件流程说明

```text
 点击“任务列表首列” ： 没有特殊情况每次一轮判断中都会点击它，防止因为卡图导致激活失败
 激活任务：打开活动页面 -- 找到任务参加按钮  -- 点击参与按钮  -- 关闭活动页面 -- 跑图 -- 循环点击npc对话框（底部）【启动某个事件】
 巡逻（道具）： 被启动后跑图  -- 到达目标地点弹出道具框  -- 点击使用道具 -- 等待5秒激活道具  -- 点击“任务列表首列”激活打怪 -- 循环点击npc对话框（底部）【启动某个事件】
 历练（道具）：放河灯、孔明灯、首饰盒、耕地、
    流程：被启动后跑图 -- 到达目标地点弹出道具框  -- 点击使用道具 -- 等待5秒激活道具 -- 点击“任务列表首列”找寻任务npc交任务 -- 跑图 -- 循环点击npc对话框（底部）【交任务 and 启动某个事件】
 寻物（药品）：
    低端需npc商店购买：被启动后跑图 -- 到达目标地点弹出"npc多选框"  -- 点击"npc多选框"top1 -- 点击购买按钮 -- 关闭npc商店 -- 点击“任务列表首列”找寻任务npc交任务 -- 跑图 -- 循环点击npc对话框（底部）【交任务 and 启动某个事件】
    高端需玩家商店购买：被启动后弹出玩家商店 -- 点击购买按钮 -- 点击确认购买 -- 关闭玩家商店 -- 点击“任务列表首列”找寻任务npc交任务 -- 跑图 -- 循环点击npc对话框（底部）【交任务 and 启动某个事件】
         当选定的物品被其他人购买了，有购买失败的风险，不过重新点击“任务列表首列”可激活——弹出玩家商店
    背包中有：被启动后跑图 -- 循环点击npc对话框（底部）【提交药品 and 启动某个事件】
 寻物（法宝）：略，当前等级不够
 寻物（装备）：需要状态保证因果关系
 救援（副本）：被启动后跑图 -- 到达目标地点弹出"npc多选框"  -- 点击"npc多选框"top1 -- 过图 -- 循环：检查在副本中就一直释放技能  
              -- 【 循环点击npc对话框（底部）【交任务】-- 点击“退出副本通知”的确定按钮 】 该组行为不执行到副本结束时间也会自动退出副本，但需要点击“任务列表首列”激活下一个事件
 研习（兵法精要）：被启动后跑图 -- 到达目标地点弹出"npc多选框" -- 点击"npc多选框"top1 -- 循环点击npc对话框（底部）  -- 点击使用道具 -- 等待5秒激活道具 
               -- 点击“任务列表首列”找寻任务npc交任务 -- 到达目标地点弹出"npc多选框" -- 点击"npc多选框"top1 -- 循环点击npc对话框（底部）【交任务 and 启动某个事件】
 10次任务完成：会自动取领取任务，但如果中断或点击“任务列表首列”会导致该自动行为失效，所以建议手动操作：检查活动页面是领取了任务，没领取激活领取流程，领取什么也不执行
 
 ps : 过图传送，点击“任务列表首列”无影响。
 ps：以防万一，再加一个关闭地图吧

```

### 任务梳理

```text
状态={state:,timeout：}
------------------------------------- 状态信息  ---------------------------------------------------
0-未激活,不包括：所有

10-初次领取任务和完成10次后再次领取任务: npc对话框（底部）、尝试激活任务
11-正常流程，不包括：提交装备-再次-提交

20-提交装备-购买其他，npc多选框_top1按钮
21-提交装备-npc商店购买：包括：npc商店购买流程
22-提交装备-正式提交：包括：装备提交按钮、点击首页任务列表

99-任务执行完成退出任务

状态（10,20,21,22），进入超时判断，修改状态
  超时，status=11
-------------------------------------------------------------------------------------------------


status=0
取消挂机
屏蔽操作前的干扰：npc对话框（底部）、关闭活动页面、关闭玩家商城页面、关闭npc商城页面、关闭各类通知页面
status in (0,10,11) AND 激活逻辑：打开活动页面、查找“活动参与按钮”、点击按钮、关闭活动页面、status = 10（睡一会用于跑图） OR status = 11
while ture :
   image = 截图操作
   超时判断
   status in (10,11) AND 循环点击npc对话框（底部）: if status == 10 : status = 11、退出当前循环；
   status in (11,20) AND 点击"npc多选框_top1按钮" : if status == 20 : status = 21、退出当前循环；
   status in (11)    AND 点击使用道具: 等待5秒激活道具、点击“任务列表首列”、退出当前循环：
   status in (11)    AND 点击搜索法宝：退出当前循环；
   status in (11)    AND 点击玩家商店购买按钮：睡-反应时间、点击确认购买、睡-反应时间、点击关闭玩家商店按钮、点击“任务列表首列”、退出当前循环；
   status in (11,21) AND 点击npc商店购买按钮：关闭npc商店、点击“任务列表首列”、if status == 21 : status = 22、退出当前循环；
   status in (11)    AND 确定在副本中，点击释放技能、退出当前循环；
   status in (11)    AND 点击购买其他按钮（提交装备）：点击去往npc商店按钮、status=20、退出当前循环；
   status in (22)    AND 点击装备提交按钮（提交装备）：status=11、退出当前循环；
   退出逻辑判断: 再次判断、break
   ---以下操作只能放到最后面，之上的顺序可以颠倒 -------------------------
   status in (0,10,11)  AND 屏蔽操作前的干扰
   status in (10,11) AND 尝试激活任务: 
   status in (11,22) AND 点击首页任务列表
   
执行失败的情况：钱不够导致商店购物失败、背包满了导致购物失败 、杭州铁匠铺的装备引导没有做完

  
```

### 排除影响因素

```text
杭州铁匠铺的装备引导任务都做完了，否则”师门-寻物-武器“触发购买装备时，等游戏角色从铁匠铺购买装备时会判断失误，直接进入引导任务。
清理背包
留够银两

```


### 问题

```text
1、活动页面最上面的那一栏”倩女初闻录“消失后怎么办？？
2、在某些地图或者过图的时候，会判断是否导致点击某些关闭按钮，进而导致点出来的是地图，当前的处理方式是，将地图关闭功能放置到清理逻辑中
   一种情况：副本中完成了部分操作，出来后点击的关闭按钮
3、在领取任务的过程中，有时会点击任务列表首页，不是师门任务，会导致进入副本
```